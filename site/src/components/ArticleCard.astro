---
import type { ArticleWithTranslation } from "../lib/db";
import type { Language } from "../i18n/config";
import { t } from "../i18n/translations";
import ClassificationBadges from "./ClassificationBadges.astro";

interface Props {
  article: ArticleWithTranslation;
  lang: Language;
}

const { article, lang } = Astro.props;
const translations = t(lang);

// Use translated title if available, otherwise original
const displayTitle =
  lang === "fr" && article.translated_title
    ? article.translated_title
    : article.source_title;

// Use translated summary if available, otherwise original
const displaySummary =
  lang === "fr" && article.translated_summary
    ? article.translated_summary
    : article.summary_original;

// Truncate summary for card display
const truncatedSummary =
  displaySummary && displaySummary.length > 200
    ? displaySummary.slice(0, 200) + "..."
    : displaySummary;

const isTranslated = article.translation_status === "translated";
---

<article class="flex flex-col rounded-xl border border-stone-200 bg-white p-6">
  {/* Badges at top */}
  <div class="mb-3">
    <ClassificationBadges
      peerReviewed={article.peer_reviewed}
      openAccess={article.open_access}
      method={article.method}
      voice={article.voice}
      lang={lang}
      compact={true}
    />
  </div>

  {/* Title */}
  <h3 class="font-semibold text-xl leading-snug text-stone-900">
    {displayTitle}
  </h3>

  {/* Authors */}
  {
    article.authors && (
      <p class="mt-1 text-xs text-stone-500">
        {article.authors}
        {article.year && <span> ({article.year})</span>}
      </p>
    )
  }

  {/* Description (flex-grow pushes footer down) */}
  {
    truncatedSummary && (
      <p class="mt-2 mb-4 font-literata text-base text-stone-600 flex-grow line-clamp-3">
        {truncatedSummary}
      </p>
    )
  }

  {/* Footer with links (mt-auto keeps at bottom) */}
  <div class="flex items-center justify-between mt-auto pt-2">
    <a
      href={`/${lang}/articles/${article.id}`}
      class="inline-flex items-center gap-1 text-sm font-medium text-primary-500 hover:underline"
    >
      {translations.home.readArticle}
      <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </a>
    {
      article.source_url && (
        <a
          href={article.source_url}
          target="_blank"
          rel="noopener noreferrer"
          class="text-sm text-stone-500 hover:text-stone-700 hover:underline"
        >
          Original (EN)
        </a>
      )
    }
  </div>
</article>
