---
import type { ArticleWithTranslation } from "../lib/db";
import type { Language } from "../i18n/config";
import { t } from "../i18n/translations";
import ClassificationBadges from "./ClassificationBadges.astro";

interface Props {
  article: ArticleWithTranslation;
  lang: Language;
}

const { article, lang } = Astro.props;
const translations = t(lang);

// Use translated title if available, otherwise original
const displayTitle =
  lang === "fr" && article.translated_title
    ? article.translated_title
    : article.source_title;

// Use translated summary if available, otherwise original
const displaySummary =
  lang === "fr" && article.translated_summary
    ? article.translated_summary
    : article.summary_original;

// Truncate summary for card display
const truncatedSummary =
  displaySummary && displaySummary.length > 200
    ? displaySummary.slice(0, 200) + "..."
    : displaySummary;

const isTranslated = article.translation_status === "translated";
---

<article class="rounded-lg border border-gray-200 bg-white p-5 transition-all hover:shadow-md">
  <a href={`/${lang}/articles/${article.id}`} class="block">
    <h3 class="font-medium text-gray-900 hover:text-primary">
      {displayTitle}
    </h3>
  </a>

  {
    article.authors && (
      <p class="mt-1 text-sm text-gray-500">
        {article.authors}
        {article.year && <span> ({article.year})</span>}
      </p>
    )
  }

  {
    truncatedSummary && (
      <p class="mt-2 text-sm text-gray-600 line-clamp-3">{truncatedSummary}</p>
    )
  }

  <div class="mt-3 flex flex-wrap items-center gap-2">
    <ClassificationBadges
      peerReviewed={article.peer_reviewed}
      openAccess={article.open_access}
      method={article.method}
      voice={article.voice}
      lang={lang}
      compact={true}
    />

    {
      isTranslated && (
        <span class="rounded-full bg-emerald-100 px-2 py-0.5 text-xs font-medium text-emerald-700">
          {lang === "fr" ? "Traduit" : "Translated"}
        </span>
      )
    }
  </div>
</article>
