---
import BaseLayout from "../../layouts/BaseLayout.astro";
import CategoryCard from "../../components/CategoryCard.astro";
import { isValidLang, type Language } from "../../i18n/config";
import { t } from "../../i18n/translations";
import { getAllCategories } from "../../lib/db";

export function getStaticPaths() {
  return [{ params: { lang: "fr" } }, { params: { lang: "en" } }];
}

const { lang } = Astro.params;

if (!isValidLang(lang)) {
  return Astro.redirect("/fr", 302);
}

const translations = t(lang as Language);
const categories = getAllCategories();

// Categories most relevant for families
const familyCategories = [
  "fondements",
  "presentation_clinique",
  "prise_en_charge",
  "trajectoire",
];

const relevantCategories = familyCategories
  .map((id) => categories.find((c) => c.id === id))
  .filter(Boolean);

const alternateUrls = {
  fr: "/fr/familles",
  en: "/en/families",
};
---

<BaseLayout
  title={translations.families.title}
  description={translations.families.intro}
  lang={lang as Language}
  alternateUrls={alternateUrls}
>
  <!-- Hero Section -->
  <section class="bg-gradient-to-b from-accent-50 to-cream-200 py-16">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
      <h1 class="font-literata text-3xl font-bold tracking-tight text-stone-900 sm:text-4xl">
        {translations.families.title}
      </h1>
      <p class="mt-4 text-lg text-stone-600">
        {translations.families.intro}
      </p>
    </div>
  </section>

  <!-- Understanding PDA Section -->
  <section class="py-12 bg-white">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
      <h2 class="text-xl font-semibold text-stone-900">
        {translations.families.understandPDA}
      </h2>

      <div class="mt-6 grid gap-4 sm:grid-cols-2">
        {
          relevantCategories.map((category) => (
            <CategoryCard
              id={category!.id}
              title={lang === "fr" ? category!.label_fr : category!.label_en}
              description={
                translations.categoryDescriptions[
                  category!.id as keyof typeof translations.categoryDescriptions
                ]
              }
              href={`/${lang}/categories/${category!.url_slug}`}
            />
          ))
        }
      </div>
    </div>
  </section>

  <!-- For Explaining to Professionals Section -->
  <section class="border-t border-stone-200 bg-stone-50 py-12">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
      <h2 class="text-xl font-semibold text-stone-900">
        {translations.families.forProfessionals}
      </h2>
      <p class="mt-2 text-stone-600">
        {translations.families.forProfessionalsSubtitle}
      </p>

      <p class="mt-6 text-stone-500">
        {
          lang === "fr"
            ? "Les articles à partager avec les professionnels seront ajoutés après la classification."
            : "Articles to share with professionals will be added after classification."
        }
      </p>
    </div>
  </section>

  <!-- All Categories -->
  <section class="py-12 bg-white">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
      <h2 class="text-xl font-semibold text-stone-900">
        {translations.nav.categories}
      </h2>
      <div class="mt-6 grid gap-4 sm:grid-cols-2">
        {
          categories.map((category) => (
            <CategoryCard
              id={category.id}
              title={lang === "fr" ? category.label_fr : category.label_en}
              description={
                translations.categoryDescriptions[
                  category.id as keyof typeof translations.categoryDescriptions
                ]
              }
              href={`/${lang}/categories/${category.url_slug}`}
            />
          ))
        }
      </div>
    </div>
  </section>
</BaseLayout>
